!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Recorder=t():(e.ZCC=e.ZCC||{},e.ZCC.Recorder=t())}(window,function(){return function(e){var t={};function i(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(n,o,function(t){return e[t]}.bind(null,o));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=28)}({28:function(e,t,i){"use strict";(function(t){var i=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),n=function(){function e(t,i){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!e.isRecordingSupported())throw new Error("Recording is not supported in this browser");this.options=Object.assign({bufferLength:4096,monitorGain:0,recordingGain:1,mediaConstraints:{audio:!0}},t),this.encoder=i,this.state="inactive"}return i(e,[{key:"clearStream",value:function(){this.stream&&(this.stream.getTracks?this.stream.getTracks().forEach(function(e){e.stop()}):this.stream.stop(),delete this.stream),this.audioContext&&(this.audioContext.close(),delete this.audioContext)}},{key:"disconnectNodes",value:function(){this.monitorGainNode.disconnect(),this.scriptProcessorNode.disconnect(),this.recordingGainNode.disconnect(),this.sourceNode.disconnect()}},{key:"getSampleRate",value:function(){return this.audioContext.sampleRate}},{key:"encodeBuffers",value:function(e){if("recording"===this.state){for(var t=[],i=0;i<e.numberOfChannels;i++)t[i]=e.getChannelData(i);this.ondata(t)}}},{key:"initAudioContext",value:function(){if(!this.audioContext){var t=e.getAudioContext();this.audioContext=new t}return this.audioContext}},{key:"initAudioGraph",value:function(){var e=this;arguments.length>0&&void 0!==arguments[0]&&arguments[0]||(this.encodeBuffers=function(){delete e.encodeBuffers}),this.scriptProcessorNode=this.audioContext.createScriptProcessor(this.options.bufferLength,this.options.numberOfChannels,this.options.numberOfChannels),this.scriptProcessorNode.connect(this.audioContext.destination),this.scriptProcessorNode.onaudioprocess=function(t){e.encodeBuffers(t.inputBuffer)},this.monitorGainNode=this.audioContext.createGain(),this.setMonitorGain(this.options.monitorGain),this.monitorGainNode.connect(this.audioContext.destination),this.recordingGainNode=this.audioContext.createGain(),this.setRecordingGain(this.options.recordingGain),this.recordingGainNode.connect(this.scriptProcessorNode)}},{key:"initSourceNode",value:function(){var e=this;return this.stream&&this.sourceNode?t.Promise.resolve(this.sourceNode):t.navigator.mediaDevices.getUserMedia(this.options.mediaConstraints).then(function(t){return e.stream=t,e.audioContext.createMediaStreamSource(t)})}},{key:"pause",value:function(){"recording"===this.state&&(this.state="paused")}},{key:"resume",value:function(){"paused"===this.state&&(this.state="recording")}},{key:"setRecordingGain",value:function(e){this.options.recordingGain=e,this.recordingGainNode&&this.audioContext&&this.recordingGainNode.gain.setTargetAtTime(e,this.audioContext.currentTime,.01)}},{key:"setMonitorGain",value:function(e){this.options.monitorGain=e,this.monitorGainNode&&this.audioContext&&this.monitorGainNode.gain.setTargetAtTime(e,this.audioContext.currentTime,.01)}},{key:"changeInputDevice",value:function(e){var t=this;"recording"===this.state&&(this.options.mediaConstraints.audio={deviceId:{exact:e}},this.disconnectNodes(),this.clearStream(),this.initAudioContext(),this.initAudioGraph(!0),this.initSourceNode().then(function(e){t.sourceNode=e,t.sourceNode.connect(t.monitorGainNode),t.sourceNode.connect(t.recordingGainNode)}))}},{key:"init",value:function(){var e=this;return"inactive"!==this.state?t.Promise.reject("Recording is not inactive"):(this.initAudioContext(),this.initAudioGraph(),this.initSourceNode().then(function(t){e.state="recording",e.sourceNode=t,e.sourceNode.connect(e.monitorGainNode),e.sourceNode.connect(e.recordingGainNode),e.onready()}))}},{key:"stop",value:function(){"inactive"!==this.state&&(this.state="inactive",this.monitorGainNode.disconnect(),this.scriptProcessorNode.disconnect(),this.recordingGainNode.disconnect(),this.sourceNode.disconnect(),this.options.leaveStreamOpen||this.clearStream(),this.encoder.postMessage({command:"done"}))}},{key:"start",value:function(){}},{key:"ondata",value:function(e){}},{key:"onready",value:function(){}}],[{key:"getAudioContext",value:function(){return t.AudioContext||t.webkitAudioContext}},{key:"isRecordingSupported",value:function(){return e.getAudioContext()&&t.navigator&&t.navigator.mediaDevices&&t.navigator.mediaDevices.getUserMedia&&t.WebAssembly}}]),e}();e.exports=n}).call(this,i(9))},9:function(e,t){var i;i=function(){return this}();try{i=i||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(i=window)}e.exports=i}})});