!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Recorder=e():(t.ZCC=t.ZCC||{},t.ZCC.Recorder=e())}(window,function(){return function(t){var e={};function i(o){if(e[o])return e[o].exports;var n=e[o]={i:o,l:!1,exports:{}};return t[o].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,o){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(o,n,function(e){return t[e]}.bind(null,n));return o},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=28)}({28:function(t,e,i){"use strict";(function(e){var i=function(){function t(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,i,o){return i&&t(e.prototype,i),o&&t(e,o),e}}(),o=function(){function t(e,i){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),!t.isRecordingSupported())throw new Error("Recording is not supported in this browser");this.options=Object.assign({bufferLength:0,monitorGain:0,recordingGain:1,mediaConstraints:{audio:!0}},e),this.encoder=i,this.state="inactive"}return i(t,[{key:"clearStream",value:function(){this.stream&&(this.stream.getTracks?this.stream.getTracks().forEach(function(t){t.stop()}):this.stream.stop(),delete this.stream),this.audioContext&&(this.audioContext.close(),delete this.audioContext)}},{key:"disconnectNodes",value:function(){this.monitorGainNode.disconnect(),this.scriptProcessorNode.disconnect(),this.recordingGainNode.disconnect(),this.sourceNode.disconnect()}},{key:"getSampleRate",value:function(){return this.audioContext.sampleRate}},{key:"encodeBuffers",value:function(t){if("recording"===this.state){for(var e=[],i=0;i<t.numberOfChannels;i++)e[i]=t.getChannelData(i);this.ondata(e)}}},{key:"initAudioContext",value:function(){if(!this.audioContext){var e=t.getAudioContext();this.audioContext=new e}return this.audioContext}},{key:"initAudioGraph",value:function(){var t=this;arguments.length>0&&void 0!==arguments[0]&&arguments[0]||(this.encodeBuffers=function(){delete t.encodeBuffers}),this.scriptProcessorNode=this.audioContext.createScriptProcessor(this.options.bufferLength,this.options.numberOfChannels,this.options.numberOfChannels),this.scriptProcessorNode.connect(this.audioContext.destination),this.scriptProcessorNode.onaudioprocess=function(e){t.encodeBuffers(e.inputBuffer),void 0!==t.bufferLimit&&++t.buffersEncoded>=t.bufferLimit&&t.stop()},this.monitorGainNode=this.audioContext.createGain(),this.setMonitorGain(this.options.monitorGain),this.monitorGainNode.connect(this.audioContext.destination),this.recordingGainNode=this.audioContext.createGain(),this.setRecordingGain(this.options.recordingGain),this.recordingGainNode.connect(this.scriptProcessorNode)}},{key:"initSourceNode",value:function(){var t=this;return this.stream&&this.sourceNode?e.Promise.resolve(this.sourceNode):e.navigator.mediaDevices.getUserMedia(this.options.mediaConstraints).then(function(e){return t.stream=e,t.audioContext.createMediaStreamSource(e)})}},{key:"pause",value:function(){"recording"===this.state&&(this.state="paused")}},{key:"resume",value:function(){"paused"===this.state&&(this.state="recording")}},{key:"setRecordingGain",value:function(t){this.options.recordingGain=t,this.recordingGainNode&&this.audioContext&&this.recordingGainNode.gain.setTargetAtTime(t,this.audioContext.currentTime,.01)}},{key:"setMonitorGain",value:function(t){this.options.monitorGain=t,this.monitorGainNode&&this.audioContext&&this.monitorGainNode.gain.setTargetAtTime(t,this.audioContext.currentTime,.01)}},{key:"changeInputDevice",value:function(t){var e=this;"recording"===this.state&&(this.options.mediaConstraints.audio={deviceId:{exact:t}},this.disconnectNodes(),this.clearStream(),this.initAudioContext(),this.initAudioGraph(!0),this.initSourceNode().then(function(t){e.sourceNode=t,e.sourceNode.connect(e.monitorGainNode),e.sourceNode.connect(e.recordingGainNode)}))}},{key:"init",value:function(){var t=this;return"inactive"!==this.state?e.Promise.reject("Recording is not inactive"):(this.initAudioContext(),this.initAudioGraph(),this.initSourceNode().then(function(e){t.state="recording",t.sourceNode=e,t.sourceNode.connect(t.monitorGainNode),t.sourceNode.connect(t.recordingGainNode),t.onready()}))}},{key:"stop",value:function(){"inactive"!==this.state&&(this.state="inactive",this.monitorGainNode.disconnect(),this.scriptProcessorNode.disconnect(),this.recordingGainNode.disconnect(),this.sourceNode.disconnect(),this.options.leaveStreamOpen||this.clearStream(),this.encoder.postMessage({command:"done"}))}},{key:"stopAfter",value:function(t){var e=this;this.stopTimeout&&(clearTimeout(this.stopTimeout),this.stopTimeout=void 0),this.stopTimeout=setTimeout(function(){e.stop()},1e3),this.setBufferLimit(t)}},{key:"setBufferLimit",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.bufferLimit=t,this.buffersEncoded=0}},{key:"start",value:function(){}},{key:"ondata",value:function(t){}},{key:"onready",value:function(){}}],[{key:"getAudioContext",value:function(){return e.AudioContext||e.webkitAudioContext}},{key:"isRecordingSupported",value:function(){return t.getAudioContext()&&e.navigator&&e.navigator.mediaDevices&&e.navigator.mediaDevices.getUserMedia&&e.WebAssembly}}]),t}();t.exports=o}).call(this,i(9))},9:function(t,e){var i;i=function(){return this}();try{i=i||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(i=window)}t.exports=i}})});